<% include partials/headerAdmin %>

<div class="container text-center mt-5">

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-outline-primary btn-md shadow mb-5" data-toggle="modal" data-target="#nulliVolad">Nulli võlad</button>

    <!-- Nulli võlad Modal -->
    <div class="modal fade" id="nulliVolad" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="exampleModalCenterTitle">Oled kindel, et tahad nullida võlad?</h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Tagasi</button>
					<form action="/admin/kasutajad" method="POST">
						<button type="submit" class="btn btn-primary">Jah, nulli võlad</button>
					</form>
				</div>
			</div>
		</div>
    </div>

    <!-- Kustuta kasutaja Modal -->
    <div class="modal fade" id="kustuta" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="exampleModalCenterTitle">Oled kindel, et tahad kasutaja kustutada?</h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Tagasi</button>
					<form id="delModal" action="" method="POST">
						<button type="submit" class="btn btn-danger">Jah, kustuta kasutaja</button>
					</form>
				</div>
			</div>
		</div>
    </div>

    <h1> Kasutajad </h1>
    <table class="table table-hover table-bordered mt-4">
        <thead>
            <tr>
				<th scope="col">Coetus</th>
                <th scope="col">Seis</th>
                <th scope="col">Nimi</th>
                <th scope="col">Võlg</th>
                <th scope="col">Kinnitatud</th>
                <th scope="col">Muuda</th>
				<th><i class="fas fa-trash-alt"></i></th>
			</tr>
        </thead>
        <tbody>
			<% kasutajad.forEach((kasutaja) => { %>
				<tr>
					<td><%= kasutaja.coetus %></td>
					<td><%= kasutaja.seisuNim %></td>
					<td><%= kasutaja.staatus + " " + kasutaja.eesnimi + " " + kasutaja.perenimi %></td>
					<td><%= kasutaja.volg.toFixed(2) %>€</td>
					<td>
						<input class="form-check-input" type="checkbox" <% if (kasutaja.admin_on_kinnitanud) {%> checked <% }%>disabled>
					</td>
					<td><a href="/admin/kasutajad/muuda/<%= kasutaja.kasutaja_id %>">Muuda</a></td>
					<td>
						<a data-toggle="modal" data-target="#kustuta" id="kustutaModal" data-id="<%= kasutaja.kasutaja_id %>">
							<i class="fas fa-trash-alt" style="color: #cc2900;"></i>
						</a>
					</td>
				</tr>
			<% }) %>
        </tbody>
    </table>
</div>

<script>

    $(document).on("click", "#kustutaModal", function () {
     	let id = $(this).data('id');
		$('#delModal').attr('action', '/admin/kasutajad/' + id + '/kustuta');
    });

</script>

<% include partials/footer %>